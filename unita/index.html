<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquivo AGL - Inova√ß√£o e Tecnologia</title> <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="container">
            <a href="#" class="logo">
                <img src="imagens/baixados(1).svg" alt="Logotipo da Empresa AGL">
                <img src="imagens/2.svg" alt="Logotipo complementar">
            </a>
            <nav>
                <ul>
                    <li><a href="#servicos">Servi√ßos</a></li>
                    <li><a href="#sobre">Sobre N√≥s</a></li>
                    <li><a href="#contato">Contato</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Inovando o Futuro com Solu√ß√µes de Tecnologia</h1>
                <p>Desenvolvemos software e sistemas sob medida para impulsionar o seu neg√≥cio.</p>
                <a href="#contato" class="cta-button">Fale com um especialista</a>
            </div>
        </section>

        <section id="servicos" class="services">
            <div class="container">
                <h2>Nossos Servi√ßos</h2>
                <div class="service-cards">
                    <div class="card">
                        <h3>Desenvolvimento Web</h3>
                        <p>Criamos sites e aplica√ß√µes web responsivas e otimizadas para a melhor experi√™ncia do usu√°rio.</p>
                    </div>
                    <div class="card">
                        <h3>Solu√ß√µes em Nuvem</h3>
                        <p>Implementamos e gerenciamos infraestrutura na nuvem para garantir escalabilidade e seguran√ßa.</p>
                    </div>
                    <div class="card">
                        <h3>Consultoria de TI</h3>
                        <p>Oferecemos orienta√ß√£o estrat√©gica para alinhar sua tecnologia aos objetivos do seu neg√≥cio.</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="sobre" class="about">
            <div class="container">
                <h2>Sobre a Arquivo AGL</h2> <p>
                    Fundada em 2015, a Arquivo AGL nasceu com a miss√£o de transformar ideias em realidade atrav√©s da tecnologia. Nossa equipe √© composta por especialistas apaixonados por inova√ß√£o e comprometidos em entregar resultados de excel√™ncia para clientes de todos os portes.
                </p>
            </div>
        </section>
    </main>
    <div id="ai-chat-widget">
    <button id="chat-bubble" aria-label="Abrir chat com assistente virtual">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 8V4H8"></path><rect x="4" y="12" width="16" height="8" rx="2"></rect><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="M17 12v-2a4 4 0 0 0-4-4H9"></path>
        </svg>
    </button>

    <div id="chat-window">
        <div class="chat-header">
            <h3>Agente Virtual AGL</h3>
            <button id="close-chat" aria-label="Fechar chat">
                &times; </button>
        </div>
        <div id="chat-messages">
            <div class="message ai">
                <p>Ol√°! üëã Sou o assistente virtual da Arquivo AGL. Como posso ajudar voc√™ hoje?</p>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Digite sua mensagem...">
            <button id="send-message" aria-label="Enviar mensagem">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
</div>
   <footer id="contato">
    <div class="container">
        <div class="copyright">
            <p>&copy; 2025 Arquivo AGL. Todos os direitos reservados.</p>
        </div>
        <div class="social-icons">
            <a href="#" aria-label="LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.784-1.75-1.75s.784-1.75 1.75-1.75 1.75.784 1.75 1.75-.784 1.75-1.75 1.75zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>
            </a>
            <a href="#" aria-label="GitHub">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.91 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
            <a href="#" aria-label="X">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/>
                </svg>
            </a>
        </div>
    </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const chatWidget = document.getElementById('ai-chat-widget');
        const chatBubble = document.getElementById('chat-bubble');
        const closeChatBtn = document.getElementById('close-chat');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendMessageBtn = document.getElementById('send-message');

        // Abre a janela do chat
        chatBubble.addEventListener('click', () => {
            chatWidget.classList.add('active');
            chatInput.focus();
        });

        // Fecha a janela do chat
        closeChatBtn.addEventListener('click', () => {
            chatWidget.classList.remove('active');
        });

        // Fun√ß√£o para adicionar mensagem ao chat
        function addMessage(text, sender) {
            // Remove o bot√£o "Abrir Chamado" de mensagens anteriores da IA
            const existingButton = chatMessages.querySelector('.create-ticket-btn');
            if (existingButton) {
                existingButton.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            const messageP = document.createElement('p');
            messageP.innerHTML = text;
            messageDiv.appendChild(messageP);

            // Se a mensagem for da IA, adiciona o bot√£o "Abrir um chamado"
            if (sender === 'ai' && !text.includes('typing-indicator')) {
                const ticketButton = document.createElement('button');
                ticketButton.textContent = 'Abrir um chamado com esta conversa';
                ticketButton.className = 'create-ticket-btn';
                
                // Evento de clique para o novo bot√£o
                ticketButton.addEventListener('click', () => {
                    console.log("Bot√£o 'Abrir um chamado' foi clicado!"); // <-- NOSSO ALERTA DE TESTE
                    const lastUserMessage = findLastUserMessage();
                    if (lastUserMessage) {
                        createTicket('D√∫vida do Chat', lastUserMessage);
                        ticketButton.textContent = 'Chamado enviado!';
                        ticketButton.disabled = true;
                    } else {
                        addMessage("N√£o encontrei uma mensagem sua para abrir o chamado.", "ai");
                    }
                });

                messageDiv.appendChild(ticketButton);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fun√ß√£o para encontrar a √∫ltima mensagem do usu√°rio
        function findLastUserMessage() {
            const userMessages = chatMessages.querySelectorAll('.message.user p');
            if (userMessages.length > 0) {
                return userMessages[userMessages.length - 1].textContent;
            }
            return null;
        }

        // Fun√ß√£o para criar o chamado no back-end
        async function createTicket(titulo, descricao) {
            console.log("Fun√ß√£o createTicket foi chamada. Enviando para o servidor..."); // <-- NOSSO ALERTA DE TESTE
            try {
                const response = await fetch('http://localhost:3000/chamadas', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ titulo, descricao }),
                });

                if (!response.ok) {
                    throw new Error('Falha na resposta do servidor.');
                }

                const data = await response.json();
                addMessage(`‚úÖ Chamado criado com sucesso! O c√≥digo de acompanhamento √©: <strong>${data.id}</strong>`, 'ai');

            } catch (error) {
                console.error('Erro ao criar chamado:', error);
                addMessage('‚ùå Desculpe, n√£o consegui criar seu chamado no momento.', 'ai');
            }
        }

        // Fun√ß√£o para mostrar indicador de "digitando..."
        function showTypingIndicator() {
            addMessage('<div class="typing-indicator"><span></span><span></span><span></span></div>', 'ai');
        }

        function removeTypingIndicator() {
            const indicator = chatMessages.querySelector('.typing-indicator');
            if (indicator) {
                indicator.parentElement.remove();
            }
        }

        // Fun√ß√£o para lidar com o envio da mensagem
        async function handleSendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            addMessage(userMessage, 'user');
            chatInput.value = '';
            showTypingIndicator();

            try {
                const response = await fetch('http://localhost:3000/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage }),
                });

                if (!response.ok) {
                    throw new Error('A resposta do servidor n√£o foi OK');
                }

                const data = await response.json();
                removeTypingIndicator();
                addMessage(data.reply, 'ai');

            } catch (error) {
                console.error("Erro ao enviar mensagem:", error);
                removeTypingIndicator();
                addMessage("Desculpe, ocorreu um erro. Tente novamente mais tarde.", 'ai');
            }
        }

        sendMessageBtn.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleSendMessage();
            }
        });
    });
</script>
</body>
</html>